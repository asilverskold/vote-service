<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet author="vasily" id="changeset1">
        <sql>
            CREATE TABLE USER
            (
                id           number generated always as identity ( start with 1 increment by 1 ) primary key,
                username     varchar(512),
                password     varchar(512)
            );
        </sql>
        <sql>
            CREATE TABLE USER_ROLE
            (
                user_id number not null,
                role    varchar(512),
                constraint fk_user_roles_user_id foreign key (user_id) references USER (id) on delete cascade
            );
        </sql>

    </changeSet>

    <changeSet author="vasily" id="changeset2">
        <sql>
            CREATE TABLE POLL
            (
                id          number generated always as identity ( start with 1 increment by 1 ) primary key,
                date        timestamp not null,
                title       varchar(512)
            );
        </sql>
        <sql>
            CREATE TABLE POLL_OPTION
            (
                id          number generated always as identity ( start with 1 increment by 1 ) primary key,
                title       varchar(512),
                poll_id     number,
                voted_count number default 0,
                constraint fk_poll_option_poll_id foreign key (poll_id) references POLL (id)
            );
        </sql>
        <sql>
            CREATE TABLE VOTE
            (
                id          number generated always as identity ( start with 1 increment by 1 ) primary key,
                poll_id     number,
                user_id     number,
                poll_option_id     number,
                constraint fk_vote_poll_id foreign key (poll_id) references POLL (id),
                constraint fk_vote_poll_option_id foreign key (poll_option_id) references POLL_OPTION (id),
                constraint fk_vote_user_id foreign key (user_id) references USER (id)
            );
        </sql>
    </changeSet>

</databaseChangeLog>